"use strict";var _react=_interopRequireDefault(require("react"));var _react2=require("@testing-library/react");var _DatePicker=_interopRequireDefault(require("./DatePicker"));var _moment=_interopRequireDefault(require("moment"));var _userEvent=_interopRequireDefault(require("@testing-library/user-event"));var _testUtils=require("react-dom/test-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}describe("DatePicker",()=>{it("Affiche un \xE9l\xE9ment input",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");expect(input).toBeInTheDocument()});it("Affiche le datepicker lorsqu'on clique sur l'input",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);const datepicker=_react2.screen.getByRole("dialog");expect(datepicker).toBeInTheDocument()});it("Cache le datepicker lorsqu'on reclique sur l'input",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);let datepicker=_react2.screen.getByRole("dialog");expect(datepicker).toBeInTheDocument();_react2.fireEvent.click(input);datepicker=_react2.screen.getByRole("dialog");expect(datepicker).toHaveClass("hidden")});it("Cache le datepicker lorsqu'on clique \xE0 l'exterieur du composant",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);let datepicker=_react2.screen.getByRole("dialog");expect(datepicker).toBeInTheDocument();_react2.fireEvent.click(document.body);datepicker=_react2.screen.getByRole("dialog");expect(datepicker).toHaveClass("hidden")});it("S\xE9lectionne une date dans le calendrier",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);// Choisissez une cellule de calendrier pour la sélection
const calendarCell=_react2.screen.getByText("15");// Assurez-vous que la date est présente dans le calendrier
_react2.fireEvent.click(calendarCell);// Vérifiez si la valeur de l'input a été mise à jour
expect(input).toHaveValue("2023-12-15");expect(_react2.screen.queryByRole("dialog")).toHaveClass("hidden");_react2.fireEvent.click(input);// Choisissez une cellule de calendrier pour la sélection
const calendarCell2=_react2.screen.getByText("16");// Assurez-vous que la date est présente dans le calendrier
_react2.fireEvent.click(calendarCell2);// Vérifiez si la valeur de l'input a été mise à jour
expect(input).toHaveValue("2023-12-16");expect(_react2.screen.queryByRole("dialog")).toHaveClass("hidden")});it("Change le mois et l'ann\xE9e dans le datepicker",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);// Choisissez le menu déroulant du mois et changez le mois
const monthDropdown=_react2.screen.getAllByRole("listbox")[0];_react2.fireEvent.click(monthDropdown);const anotherMonth=_react2.screen.getByText("May");_react2.fireEvent.click(anotherMonth);expect(monthDropdown).toHaveTextContent("May");const yearDropdown=_react2.screen.getAllByRole("listbox")[1];_react2.fireEvent.click(yearDropdown);const anotherYear=_react2.screen.getByText("1958");_react2.fireEvent.click(anotherYear);expect(yearDropdown).toHaveTextContent("1958")});test("Interaction avec le DatePicker",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{name:"datePicker",id:"datePicker"}));const input=_react2.screen.getByRole("textbox");const datePickerContainer=_react2.screen.getByRole("dialog");_react2.fireEvent.click(input);const selectedDate=_react2.screen.getByText("15");_react2.fireEvent.click(selectedDate);expect(input).toHaveValue("2023-12-15");expect(datePickerContainer).toHaveClass("hidden");_react2.fireEvent.click(input);_react2.fireEvent.click(selectedDate);expect(input).toHaveValue("2023-12-15");const differentDate=_react2.screen.getByText("20");_react2.fireEvent.click(differentDate);expect(input).toHaveValue("2023-12-20");expect(datePickerContainer).toHaveClass("hidden")});it("R\xE9initialise le datepicker \xE0 la date du jour",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);expect(input).toHaveValue("");// Sélectionnez une date dans le calendrier
const calendarCell=_react2.screen.getByText("15");_react2.fireEvent.click(calendarCell);expect(input).toHaveValue("2023-12-15");// Réinitialisez le datepicker
const resetButton=_react2.screen.getByLabelText("Reset to current date");_react2.fireEvent.click(resetButton);// Vérifiez si le datepicker est réinitialisé à l'état initial
expect(input).toHaveValue((0,_moment.default)().format("YYYY-MM-DD"));expect(_react2.screen.queryByRole("dialog")).toHaveClass("hidden")});it("Passe aux mois suivant et precedents",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);const monthDropdown=_react2.screen.getAllByRole("listbox")[0];expect(monthDropdown).toHaveTextContent("December");const nextMonthBtn=_react2.screen.getByLabelText("Next month");_react2.fireEvent.click(nextMonthBtn);expect(monthDropdown).toHaveTextContent("January");const previousMonthBtn=_react2.screen.getByLabelText("Previous month");_react2.fireEvent.click(previousMonthBtn);_react2.fireEvent.click(previousMonthBtn);expect(monthDropdown).toHaveTextContent("November")});it("N'accepte pas les dates invalides dans l'input",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.change(input,{target:{value:"invalid date"}});_react2.fireEvent.blur(input);expect(input.value).toBe("")});it("Efface la date s\xE9lectionn\xE9e lorsqu'on vide l'input",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);const calendarCell=_react2.screen.getByText("15");_react2.fireEvent.click(calendarCell);expect(input).toHaveValue("2023-12-15");_react2.fireEvent.change(input,{target:{value:""}});expect(input).toHaveValue("")});it("Emp\xEAche la s\xE9lection des dates inf\xE9rieures \xE0 la `minDate`",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{minDate:"2023-12-15"}}));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);const calendarCell=_react2.screen.getByText("14");_react2.fireEvent.click(calendarCell);expect(input).toHaveValue("")});it("Emp\xEAche la s\xE9lection des dates sup\xE9rieures \xE0 la `maxDate`",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{maxDate:"2023-12-15"}}));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);const calendarCell=_react2.screen.getByText("16");_react2.fireEvent.click(calendarCell);expect(input).toHaveValue("")});it("Pr\xE9-s\xE9lectionne une date sp\xE9cifique",()=>{const selectedDate=(0,_moment.default)("1985-10-26");(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{defaultDate:selectedDate}}));const input=_react2.screen.getByRole("textbox");expect(input).toHaveValue("1985-10-26");expect(_react2.screen.getByText("26")).toHaveClass("selected-cell")});it("Permet de saisir les dates dans un format diff\xE9rent",()=>{const format="MM/YYYY/DD";(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{format,defaultDate:"12/2023/31"}}));const input=_react2.screen.getByRole("textbox");expect(input).toHaveValue("12/2023/31")});it("Formate les dates saisies dans un format diff\xE9rent",()=>{const format="DD/MM/YYYY";(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{format}}));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.change(input,{target:{value:"2023/12/31"}});_react2.fireEvent.blur(input);expect(input).toHaveValue((0,_moment.default)().format(format))});it("R\xE9initialise le DatePicker avec le ref",async()=>{const datePickerRef=/*#__PURE__*/_react.default.createRef();(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{ref:datePickerRef}));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);const calendarCell=_react2.screen.getByText("15");_react2.fireEvent.click(calendarCell);expect(input).toHaveValue("2023-12-15");await(0,_react2.waitFor)(()=>{datePickerRef.current.resetDatePicker();expect(input).toHaveValue("")});expect(_react2.screen.queryByRole("dialog")).toHaveClass("hidden")});it("Cache correctement le DatePicker lorsqu'`options.datepicker` est false",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{datepicker:false}}));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);expect(_react2.screen.queryByRole("dialog")).not.toBeInTheDocument()});it("R\xE9agit correctement aux changements d'options",()=>{const{rerender}=(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{lang:"en"}}));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);expect(_react2.screen.getByText("Sun")).toBeTruthy();rerender(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{lang:"fr"}}));expect(_react2.screen.getByText("Dim")).toBeTruthy()});it("Change correctement le mois en mode RTL",()=>{const{rerender}=(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{rtl:false}}));let input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);expect(_react2.screen.getAllByRole("button")[0]).toHaveAttribute("aria-label","Previous month");rerender(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{options:{rtl:true}}));input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);expect(_react2.screen.getAllByRole("button")[0]).toHaveAttribute("aria-label","Next month")});test("calls onChange when the selected date changes",()=>{const mockOnChange=jest.fn();(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,{onChange:mockOnChange}));const input=_react2.screen.getByRole("textbox");_react2.fireEvent.click(input);const calendarCell=_react2.screen.getByText("15");_react2.fireEvent.click(calendarCell);expect(mockOnChange).toHaveBeenCalledWith(expect.any(Object))});test("Saisie de date au clavier",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");(0,_testUtils.act)(()=>{_userEvent.default.type(input,"2023-12-10");_react2.fireEvent.blur(input)});expect(input).toHaveValue("2023-12-10");(0,_testUtils.act)(()=>{_userEvent.default.type(input,"/fsdfsdfsd21@/");_react2.fireEvent.blur(input)});expect(input).toHaveValue("2023-12-10")});test("Saisie de date au clavier avec validation par Enter",()=>{(0,_react2.render)(/*#__PURE__*/_react.default.createElement(_DatePicker.default,null));const input=_react2.screen.getByRole("textbox");const datePickerContainer=_react2.screen.getByRole("dialog");(0,_testUtils.act)(()=>{_userEvent.default.type(input,"2023-12-10");_react2.fireEvent.keyDown(input,{key:"Enter"});expect(input).toHaveValue("2023-12-10");expect(datePickerContainer).toHaveClass("hidden")})})});